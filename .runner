@vars:
    CMD=go
    BUILD_DIR=build

@cat:
    VERSION=./version

build:
    mkdir -p {{BUILD_DIR}}/
    {{CMD}} build -trimpath -ldflags='-s -w -X main.version={{VERSION}}' -o {{BUILD_DIR}}/harbrix ./cmd/harbrix/main.go
    {{CMD}} build -trimpath -ldflags='-s -w' -o {{BUILD_DIR}}/harbrixd ./cmd/harbrixd/main.go

harbrixd:
    {{CMD}} run ./cmd/harbrixd/main.go

harbrix:
    {{CMD}} run ./cmd/harbrix/main.go {{1}}

test1:
    {{CMD}} run ./tests/test_client1.go

mkduser:
    sudo useradd --system --no-create-home --shell /usr/sbin/nologin harbrix

cpb:
    sudo cp build/harbrix /usr/local/bin/harbrix
    sudo cp build/harbrixd /usr/local/bin/harbrixd